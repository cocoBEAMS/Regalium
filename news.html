<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>News Feed â€” Regalium</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0d14;
    --panel: #0f1420;
    --border: #1e2638;
    --text: #e9ecf1;
    --muted: #8b93a7;
    --blue: #3b82f6;
    --red: #ef4444;
    --radius: 14px;
  }

  * { box-sizing: border-box; }
  body {
    margin: 0;
    min-height: 100vh;
    background: var(--bg);
    color: var(--text);
    font-family: 'Inter', system-ui, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  nav {
    height: 64px;
    width: 100%;
    max-width: 1100px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 24px;
    border-bottom: 1px solid var(--border);
    background: var(--bg);
    margin-bottom: 16px;
  }

  .logo { font-weight: 800; letter-spacing: -0.02em; font-size: 20px; }

  header {
    width: 100%;
    max-width: 1100px;
    font-size: 24px;
    font-weight: 700;
    text-align: center;
    margin: 16px 0;
  }

  .container {
    width: 100%;
    max-width: 1100px;
    padding: 0 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  /* ===== NEWS CARD ===== */
  .news-card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    transition: transform 0.2s, border-color 0.2s;
  }

  .news-card:hover { transform: translateY(-3px); border-color: var(--blue); }

  .news-card img {
    width: 100%;
    object-fit: cover;
    max-height: 280px;
  }

  .news-content {
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .news-content h3 {
    margin: 0;
    font-weight: 600;
    color: var(--blue);
    font-size: 18px;
  }

  .news-content p {
    margin: 0;
    font-size: 14px;
    line-height: 1.5;
    color: var(--text);
  }

  .news-footer {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    opacity: 0.7;
    align-items: center;
    margin-top: 8px;
  }

  .news-footer .label {
    background: var(--blue);
    color: white;
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 10px;
    text-transform: uppercase;
  }

  /* ===== ADD POST BUTTON ===== */
  #addPostBtn {
    position: fixed;
    bottom: 24px;
    right: 24px;
    background: linear-gradient(135deg,#6d6dff,#9b7bff);
    color: white;
    padding: 14px 20px;
    border: none;
    border-radius: 999px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 12px 30px rgba(109,109,255,0.35);
    display: none;
    z-index: 1000;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  #addPostBtn:hover { transform: translateY(-2px); box-shadow: 0 18px 40px rgba(109,109,255,0.45); }

  /* ===== MODAL ===== */
  .overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }

  .modal {
    width: 100%;
    max-width: 420px;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 18px;
    padding: 24px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .modal h2 { margin:0 0 8px; font-size:20px; text-align:center; }
  .modal input, .modal textarea {
    width: 100%;
    padding: 12px;
    border-radius: 12px;
    border: 1px solid var(--border);
    background: var(--bg);
    color: var(--text);
    font-size: 14px;
  }

  .modal button {
    padding: 12px;
    border-radius: 12px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    background: var(--blue);
    color: white;
    transition: opacity 0.2s;
  }

  .modal button:hover { opacity: 0.9; }

  /* ===== PLACEHOLDER ===== */
  #feed p.placeholder {
    text-align: center;
    color: var(--muted);
    font-size: 14px;
    margin-top: 40px;
  }

</style>
</head>
<body>

<nav>
  <div class="logo">Regalium</div>
</nav>

<header>News Feed</header>

<div class="container" id="feed"></div>

<button id="addPostBtn">Add Post</button>

<div class="overlay" id="modal">
  <div class="modal">
    <h2>New Post</h2>
    <input id="postTitle" placeholder="Title" />
    <textarea id="postContent" placeholder="Content" rows="4"></textarea>
    <input id="postLabel" placeholder="Label (optional)" />
    <input id="postImage" placeholder="Image URL (optional)" />
    <button id="submitPost">Submit</button>
    <button id="closeModal" style="background:#ef4444;">Cancel</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyCvCAnjI58ns5dWgmcY_saq1w3W_Qe9I7Y",
  authDomain:"friendconnect-99a50.firebaseapp.com",
  projectId:"friendconnect-99a50",
  storageBucket:"friendconnect-99a50.appspot.com",
  messagingSenderId:"904196830848",
  appId:"1:904196830848:web:50c15121c2c04f1ea01865"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const feedEl = document.getElementById("feed");
const addPostBtn = document.getElementById("addPostBtn");
const modal = document.getElementById("modal");
const closeModalBtn = document.getElementById("closeModal");
const submitPostBtn = document.getElementById("submitPost");
const postTitleEl = document.getElementById("postTitle");
const postContentEl = document.getElementById("postContent");
const postLabelEl = document.getElementById("postLabel");
const postImageEl = document.getElementById("postImage");

const ADMIN_UID = "0HTiNpLwIxaGtfJh5lWjJEed3K53";
let currentUser = null;

function timeAgo(date){
  if(!date) return "";
  const seconds = Math.floor((new Date()-date)/1000);
  if(seconds<60) return "just now";
  if(seconds<3600) return Math.floor(seconds/60)+" min ago";
  if(seconds<86400) return Math.floor(seconds/3600)+" hr ago";
  return Math.floor(seconds/86400)+" d ago";
}

addPostBtn.onclick = ()=>modal.style.display="flex";
closeModalBtn.onclick = ()=>modal.style.display="none";

submitPostBtn.onclick = async ()=>{
  const title = postTitleEl.value.trim();
  const content = postContentEl.value.trim();
  const label = postLabelEl.value.trim();
  const image = postImageEl.value.trim();
  if(!title||!content){ alert("Title and content required!"); return; }
  if(currentUser.uid!==ADMIN_UID){ alert("Only admin can post!"); return; }

  try{
    await addDoc(collection(db,"newsFeed"),{
      title,
      content,
      label: label || null,
      imageUrl: image || null,
      author: "Admin",
      createdAt: serverTimestamp()
    });
    postTitleEl.value=""; postContentEl.value=""; postLabelEl.value=""; postImageEl.value="";
    modal.style.display="none";
  }catch(e){
    alert("Error posting: "+e.message);
    console.error(e);
  }
};

const q=query(collection(db,"newsFeed"),orderBy("createdAt","desc"));
onSnapshot(q,snap=>{
  feedEl.innerHTML="";
  if(snap.empty){
    const p=document.createElement("p");
    p.className="placeholder";
    p.textContent="Nothing to see here yet!";
    feedEl.appendChild(p);
    return;
  }
  snap.forEach(doc=>{
    const post = doc.data();
    const card = document.createElement("div");
    card.className="news-card";
    card.innerHTML=`
      ${post.imageUrl?`<img src="${post.imageUrl}" />`:``}
      <div class="news-content">
        <h3>${post.title}</h3>
        <p>${post.content}</p>
        <div class="news-footer">
          <span>${post.author||"Unknown"}</span>
          <span>${post.label?`<span class="label">${post.label}</span>`:""} ${post.createdAt?.toDate?timeAgo(post.createdAt.toDate()):""}</span>
        </div>
      </div>
    `;
    feedEl.appendChild(card);
  });
});

onAuthStateChanged(auth,user=>{
  if(!user) return;
  currentUser=user;
  addPostBtn.style.display=(user.uid===ADMIN_UID)?"block":"none";
});
</script>

</body>
</html>
